datasource db {
  provider = "mysql"
}

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

model User {
  id                    Int       @id @default(autoincrement())
  name                  String
  email                 String    @unique
  password              String
  avatar                String?
  biography             String?   @db.Text
  rememberMeToken       String?   @unique
  rememberMeTokenExpiry DateTime?
  passwordResetToken     String?   @unique @db.VarChar(255)
  passwordResetExpiresAt DateTime?
  verificationToken      String?   @unique @db.VarChar(255)
  verificationExpires    DateTime?
  role                  String
  isGuest               Boolean   @default(false)
  isEnabled             Boolean   @default(true)
  lastLoginAt           DateTime?
  creatorId             Int?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  creator               User?     @relation("UserToUser", fields: [creatorId], references: [id])
  createdUsers          User[]    @relation("UserToUser")
  Events                Event[]
  Comments              Comment[]
  Activities            Activity[]
  Records               Record[]
  News                  News[]
  Articles              Article[]
  Locations             Location[]
}

model Event {
  id          Int       @id @default(autoincrement())
  title       String
  description String?   @db.Text
  url         String?
  start       DateTime
  end         DateTime
  isAllDay    Boolean   @default(false)
  categoryId  String    @default("")
  creatorId   Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  creator     User      @relation(fields: [creatorId], references: [id])
  Comments    Comment[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  eventId   Int
  creatorId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  event     Event    @relation(fields: [eventId], references: [id])
  creator   User     @relation(fields: [creatorId], references: [id])
}

model Activity {
  id          Int      @id @default(autoincrement())
  type        String   // アクティビティの種類
  title       String
  description String?  @db.Text // アクティビティの詳細情報
  metadata    Json?    // 追加のメタデータ（JSON形式で保存）
  userId      Int      // アクティビティを実行したユーザ
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])
}

model Record {
  id          Int      @id @default(autoincrement())
  location    String   // 活動場所
  datetime    String   // 活動日時
  eventDate   DateTime // 比較用の活動日
  weather     String   // 天候
  participants String  // 参加者
  reporter    String   // 報告者
  content     String   @db.Text // 活動内容
  nearMiss    String?  @db.Text // ヒヤリハット
  equipment   String?  // 動力使用
  remarks     String?  @db.Text // 備考
  categories  Json?    // カテゴリ（JSON配列として保存）
  images      Json?    // 画像ファイル名（JSON配列として保存）
  status      String   @default("published") // 状態（draft: 下書き、published: 公開、archived: アーカイブ）
  creatorId   Int      // 記録作成者
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  creator     User     @relation(fields: [creatorId], references: [id])
}

model News {
  id          Int      @id @default(autoincrement())
  title       String   // お知らせのタイトル
  content     String   @db.Text // お知らせの内容
  date        DateTime // お知らせの日付
  categories  Json?    // カテゴリ（募集、保険、イベント、定例活動、講習、会報、事務局、会員向け、一般向けなど、JSON配列として保存）
  priority    String?  // 優先度（重要、至急、要確認など）
  attachments Json?    // 添付ファイル（JSON配列として保存）
  downloadStats Json?  // ファイルごとのダウンロード統計（JSON形式で保存）
  isMemberOnly Boolean @default(false) // 会員限定コンテンツかどうか
  author      String   // 作成者
  status      String   @default("published") // 状態（draft: 下書き、published: 公開、scheduled: 予約投稿、archived: アーカイブ）
  creatorId   Int      // お知らせ作成者
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  creator     User     @relation(fields: [creatorId], references: [id])
}

model Article {
  id          Int      @id @default(autoincrement())
  title       String   // 記事のタイトル
  content     String   @db.Text // 記事の内容（MDX形式）
  featuredImage String? // アイキャッチ画像のパス
  images      Json?    // 記事内で使用する画像ファイル名（JSON配列として保存）
  attachments Json?    // 添付ファイル（PDF、ドキュメントなど、JSON配列として保存）
  tags        Json?    // タグ（JSON配列として保存）
  category    String?  // カテゴリ
  status      String   @default("draft") // 状態（draft: 下書き、published: 公開、archived: アーカイブ）
  publishedAt DateTime? // 公開日時
  seoDescription String? // SEO用説明
  seoKeywords  String? // SEO用キーワード
  isMemberOnly Boolean @default(false) // 会員限定コンテンツかどうか
  viewCount   Int      @default(0) // 閲覧回数
  downloadStats Json?  // 添付ファイルごとのダウンロード統計（JSON形式で保存）
  creatorId   Int      // 記事作成者
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  creator     User     @relation(fields: [creatorId], references: [id])
}

model Location {
  id                       String   @id // 活動地ID（例: "minoh", "kongosan"）
  name                     String   // 活動地名
  position                 Json     // 位置情報 [latitude, longitude]
  type                     String   // 活動地タイプ（regular: 定例活動地, activity: その他の活動）
  activities               String?  @db.Text // 活動内容の概要
  image                    String?  // メイン画像URL
  address                  String?  // 住所
  hasDetail                Boolean  @default(false) // 詳細情報の有無
  
  // 詳細情報（hasDetail=true の場合に使用）
  activityDetails          String?  @db.Text // 活動内容の詳細説明
  fieldCharacteristics     String?  @db.Text // フィールドの特徴
  access                   String?  @db.Text // アクセス方法
  facilities               String?  @db.Text // 施設情報
  schedule                 String?  // 活動スケジュール
  requirements             String?  @db.Text // 持ち物・服装
  participationFee         String?  // 参加費
  contact                  String?  // 連絡先
  organizer                String?  // 活動世話人
  startedDate              String?  // 活動開始年月
  notes                    String?  @db.Text // 注意事項
  other                    String?  @db.Text // その他の情報
  
  // 集合場所情報
  meetingAddress           String?  @db.Text // 集合場所の住所
  meetingTime              String?  // 集合時間
  meetingMapUrl            String?  @db.Text // Google Maps埋め込みURL
  meetingAdditionalInfo    String?  @db.Text // 集合場所の補足情報
  
  // メディア・添付ファイル
  images                   Json?    // 画像ギャラリー（URL配列）
  attachments              Json?    // 添付ファイル（PDF等、JSON配列として保存）
  upcomingDates            Json?    // 今後の活動予定日（日付文字列の配列）
  
  // 状態管理
  status                   String   @default("published") // 状態（draft: 下書き、published: 公開、archived: アーカイブ）
  
  // 作成者・タイムスタンプ
  creatorId                Int      // 作成者
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  creator                  User     @relation(fields: [creatorId], references: [id])
}
